<div class="standard-checklist">
  <h2>D√©tails du rapport</h2>
  <div class="checklist-table">

    <div class="checklist-row">
      <label>Type</label>
      <input type="text" [value]="reportMetadata?.type" disabled />
    </div>

    <div class="checklist-row">
      <label>Num√©ro de s√©rie</label>
      <input type="text" [value]="reportMetadata?.serialNumber" disabled />
    </div>

    <div class="checklist-row">
      <label>Description √©quipement</label>
      <input type="text" [value]="reportMetadata?.equipmentDescription" disabled />
    </div>

    <div class="checklist-row">
      <label>D√©signation</label>
      <input type="text" [value]="reportMetadata?.designation" disabled />
    </div>

    <div class="checklist-row">
      <label>Fabricant</label>
      <input type="text" [value]="reportMetadata?.manufacturer" disabled />
    </div>

    <div class="checklist-row">
      <label>Service Segment</label>
      <input type="text" [value]="reportMetadata?.serviceSeg" disabled />
    </div>

    <div class="checklist-row">
      <label>Business Unit</label>
      <input type="text" [value]="reportMetadata?.businessUnit" disabled />
    </div>

    <div class="checklist-row">
      <label>Immobilisation</label>
      <input
        type="text"
        [(ngModel)]="reportMetadata.immobilization"
        [disabled]="!canEditImmobilization()"
        name="immobilization" />
    </div>

    <div *ngIf="canEditImmobilization()">
      <button (click)="updateImmobilization()">üíæ Sauvegarder Immobilisation</button>
    </div>

  </div>
</div>

<div class="standard-checklist">
  <h2>Checklist Standard</h2>

  <form (ngSubmit)="submitStandardChecklist()" *ngIf="standardChecklist?.length">
    <div class="checklist-table">
      <div class="header-row">
        <div>Crit√®res de contr√¥le</div>
        <div>Responsable Impl√©mentation</div>
        <div>Responsable Check</div>
        <div>Impl√©</div>
        <div>Action</div>
        <div>Responsable action</div>
        <div>D√©lais</div>
        <div>Contr√¥le de succ√®s</div>
      </div>

      <div *ngFor="let item of standardChecklist" class="checklist-row">
        <div class="desc">{{ item.criteriaDescription }}</div>
        <div>{{ item.implementationResponsible?.name }}</div>
        <div>{{ item.checkResponsible?.name }}</div>

        <div>
          <select
            [disabled]="!item.editable"
            [(ngModel)]="item.implemented"
            name="implemented-{{ item.entryId }}"
            (ngModelChange)="item.isFilled = true">
            <option [ngValue]="true">‚úîÔ∏è</option>
            <option [ngValue]="false">‚ùå</option>
          </select>
        </div>

        <div>
          <input
            type="text"
            placeholder="Action"
            [disabled]="!item.editable || (item.implemented ?? false)"

            [(ngModel)]="item.action"
            name="action-{{ item.entryId }}"
            (ngModelChange)="item.isFilled = true" />
        </div>

        <div>
          <input
            type="text"
            placeholder="Responsable"
            [disabled]="!item.editable || (item.implemented ?? false)"

            [(ngModel)]="item.responsableAction"
            name="responsable-{{ item.entryId }}"
            (ngModelChange)="item.isFilled = true" />
        </div>

        <input
        type="date"
        [disabled]="!item.editable || (item.implemented ?? false)"

        [(ngModel)]="item.deadline"
        name="deadline-{{ item.entryId }}"
        (ngModelChange)="item.isFilled = true" />



        <div>
          <input
            type="text"
            placeholder="Contr√¥le"
            [disabled]="!item.editable || (item.implemented ?? false)"

            [(ngModel)]="item.successControl"
            name="control-{{ item.entryId }}"
            (ngModelChange)="item.isFilled = true" />
        </div>
      </div>
    </div>
    <button
    type="submit"
    class="mt-4"
    [disabled]="!hasFilledStandardEntries()">
    Enregistrer la checklist
  </button>
</form>



  <div class="standard-checklist">
    <h2>Checklist Sp√©cifique</h2>

    <form (ngSubmit)="submitSpecificChecklist()" *ngIf="specificChecklist?.length">
      <div class="checklist-table">
        <div class="header-row">
          <div>Crit√®res de contr√¥le</div>
          <div>D√©partements Impl√©mentation</div>
          <div>D√©partements Check</div>
          <div>Homologation</div>
          <div>Action</div>
          <div>Responsable action</div>
          <div>D√©lais</div>
          <div>Contr√¥le de succ√®s</div>
        </div>

        <div *ngFor="let item of specificChecklist" class="checklist-row">
          <div class="desc">{{ item.criteriaDescription }}</div>
          <div>{{ getDepartmentNames(item.implementationResponsibles) }}</div>
          <div>{{ getDepartmentNames(item.checkResponsibles) }}</div>

          <div>
            <select
              [disabled]="!item.editable"
              [(ngModel)]="item.homologation"
              name="homologation-{{ item.entryId }}"
              (ngModelChange)="item.isFilled = true">
              <option [ngValue]="true">‚úîÔ∏è</option>
              <option [ngValue]="false">‚ùå</option>
            </select>
          </div>

          <div>
            <input
              type="text"
              placeholder="Action"
              [disabled]="!item.editable || (item.homologation ?? false)"

              [(ngModel)]="item.action"
              name="action-{{ item.entryId }}"
              (ngModelChange)="item.isFilled = true" />
          </div>

          <div>
            <input
              type="text"
              placeholder="Responsable"
              [disabled]="!item.editable || (item.homologation ?? false)"

              [(ngModel)]="item.responsableAction"
              name="responsable-{{ item.entryId }}"
              (ngModelChange)="item.isFilled = true" />
          </div>

          <input
          type="date"
          [disabled]="!item.editable || (item.homologation ?? false)"

          [(ngModel)]="item.deadline"
          name="deadline-{{ item.entryId }}"
          (ngModelChange)="item.isFilled = true" />


          <div>
            <input
              type="text"
              placeholder="Contr√¥le"
              [disabled]="!item.editable || (item.homologation ?? false)"

              [(ngModel)]="item.successControl"
              name="control-{{ item.entryId }}"
              (ngModelChange)="item.isFilled = true" />
          </div>
        </div>
      </div>

      <button
      type="submit"
      class="mt-4"
      [disabled]="!hasFilledSpecificEntries()">
      Enregistrer la checklist
    </button>
    </form>
  </div>


<div class="standard-checklist">
  <h2>Fiche Maintenance</h2>

  <form (ngSubmit)="updateMaintenanceForm()" *ngIf="maintenanceForm">
    <div class="checklist-table">

      <!-- Maintenance System fields -->
      <div class="checklist-row">
        <label>Contr√¥l√© selon</label>
        <select [(ngModel)]="maintenanceForm.form.controlStandard" name="controlStandard" [disabled]="!canEditMaintenancePart()">
          <option [ngValue]="'VDE_0100'">VDE 0100</option>
          <option [ngValue]="'NFC_15_100'">NFC 15-100</option>
          <option [ngValue]="'NONE'">Aucun</option>
        </select>
      </div>

      <div class="checklist-row">
        <label>Nature du courant</label>
        <select [(ngModel)]="maintenanceForm.form.currentType" name="currentType"
                [disabled]="!canEditMaintenancePart()">
          <option [ngValue]="'NONE'">Aucun</option>
          <option [ngValue]="'AC'">AC</option>
          <option [ngValue]="'DC'">DC</option>
        </select>
      </div>

      <div class="checklist-row">
        <label>Forme de r√©seau</label>
        <select [(ngModel)]="maintenanceForm.form.networkForm" name="networkForm"
                [disabled]="!canEditMaintenancePart()">
          <option [ngValue]="'SYSTEM_3_CONDUCTORS'">Syst√®me √† 3 conducteurs</option>
          <option [ngValue]="'SYSTEM_4_CONDUCTORS'">Syst√®me √† 4 conducteurs</option>
          <option [ngValue]="'SYSTEM_5_CONDUCTORS'">Syst√®me √† 5 conducteurs</option>
        </select>
      </div>

      <div class="checklist-row">
        <label>Circuit de puissance</label>
        <input [(ngModel)]="maintenanceForm.form.powerCircuit" name="powerCircuit" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Circuit de commande</label>
        <input [(ngModel)]="maintenanceForm.form.controlCircuit" name="controlCircuit" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Valeur du fusible</label>
        <input [(ngModel)]="maintenanceForm.form.fuseValue" name="fuseValue" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Fr√©quence</label>
        <input [(ngModel)]="maintenanceForm.form.frequency" name="frequency" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Phase/Phase 380v</label>
        <input [(ngModel)]="maintenanceForm.form.phaseBalanceTest380v" name="phaseBalanceTest380v" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Phase/Neutre 210v</label>
        <input [(ngModel)]="maintenanceForm.form.phaseBalanceTest210v" name="phaseBalanceTest210v" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>R√©sistance isolement moteur</label>
        <input [(ngModel)]="maintenanceForm.form.insulationResistanceMotor" name="insulationResistanceMotor" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>R√©sistance isolement c√¢ble</label>
        <input [(ngModel)]="maintenanceForm.form.insulationResistanceCable" name="insulationResistanceCable" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Hauteur machine</label>
        <input [(ngModel)]="maintenanceForm.form.machineSizeHeight" name="machineSizeHeight" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Longueur machine</label>
        <input [(ngModel)]="maintenanceForm.form.machineSizeLength" name="machineSizeLength" [disabled]="!canEditMaintenancePart()" />
      </div>

      <div class="checklist-row">
        <label>Largeur machine</label>
        <input [(ngModel)]="maintenanceForm.form.machineSizeWidth" name="machineSizeWidth" [disabled]="!canEditMaintenancePart()" />
      </div>

      <!-- SHE-specific fields -->
      <div class="checklist-row">
        <label>Transformateur</label>
        <select [(ngModel)]="maintenanceForm.form.hasTransformer" name="hasTransformer"
                [disabled]="!canEditMaintenancePart()">
          <option [ngValue]="true">Oui</option>
          <option [ngValue]="false">Non</option>
        </select>
      </div>

      <div class="checklist-row">
        <label>Est en ordre</label>
        <select [(ngModel)]="maintenanceForm.form.isInOrder" name="isInOrder"
                [disabled]="!canEditShePart()">
          <option [ngValue]="true">Oui</option>
          <option [ngValue]="false">Non</option>
        </select>
      </div>

    </div>

    <button type="submit" [disabled]="!(canEditMaintenancePart() || canEditShePart())">Enregistrer</button>
  </form>
</div>
<div class="standard-checklist">
  <h2>Validation Finale</h2>

  <form *ngIf="validationChecklist?.length">
    <div class="checklist-table">
      <div class="header-row">
        <div>Crit√®re</div>
        <div>D√©partement</div>
        <div>Statut</div>
        <div>Raison</div>
        <div>Date</div>
        <div>Action</div>
      </div>

      <div *ngFor="let item of validationChecklist" class="checklist-row">
        <div>{{ item.criteria }}</div>
        <div>{{ item.department.name }}</div>

        <div>
          <select
            [(ngModel)]="item.status"
            [disabled]="!canEditValidation(item)"
            name="status-{{ item.id }}">
            <option [ngValue]="true">‚úîÔ∏è OK</option>
            <option [ngValue]="false">‚ùå Not OK</option>
          </select>
        </div>

        <div>
          <input
            type="text"
            placeholder="Raison"
            [(ngModel)]="item.reason"
            [disabled]="!canEditValidation(item) || item.status === true"
            name="reason-{{ item.id }}" />
        </div>

        <input
        type="date"
        [value]="item.updated ? (item.date ?? '') : (canEditValidation(item) ? today : '')"
        [disabled]="true"
        name="date-{{ item.id }}" />





        <div>
          <ng-container *ngIf="item.updated; else signButton">
            <span class="signed-label"> Sign√©‚úîÔ∏è </span>
          </ng-container>
          <ng-template #signButton>
            <button
              type="button"
              [disabled]="!canEditValidation(item) || item.status == null"
              (click)="updateValidationEntry(item)">
              Signer
            </button>
          </ng-template>

        </div>
      </div>
    </div>
  </form>
</div>


